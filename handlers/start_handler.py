from aiogram import Router, types, F
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton, FSInputFile
from aiogram.filters import Command
from aiogram import Dispatcher, Bot
import asyncio
import os

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä—ã –∏–∑ —Ñ–∞–π–ª–∞ routers.py (–µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å)
# from routers import currency_router, movies_router, joke_router

# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /start
start_router = Router()

# –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
IMAGES_DIR = "images"

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
@start_router.message(Command('start'))
async def send_welcome(message: types.Message):
    name = message.from_user.first_name

    # –°–æ–∑–¥–∞–Ω–∏–µ inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="–ö–∞—Ä—Ç–∏–Ω–∫–∞", callback_data="picture"),
         InlineKeyboardButton(text="–ü–æ–≥–æ–¥–∞", callback_data="weather")],
        [InlineKeyboardButton(text="–ö—É—Ä—Å –≤–∞–ª—é—Ç", callback_data="currency"),
         InlineKeyboardButton(text="–°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤", callback_data="movies")],
        [InlineKeyboardButton(text="–®—É—Ç–∫–∞", callback_data="joke"),
         InlineKeyboardButton(text="–û–ø—Ä–æ—Å", callback_data="poll")]
    ])

    await message.reply(f"–ü—Ä–∏–≤–µ—Ç, {name}! –í—ã–±–µ—Ä–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å:", reply_markup=keyboard)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ö–∞—Ä—Ç–∏–Ω–∫–∞"
@start_router.callback_query(F.data == "picture")
async def send_picture(callback: types.CallbackQuery):
    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ images
    images = os.listdir(IMAGES_DIR)
    if images:
        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        random_image = os.path.join(IMAGES_DIR, random.choice(images))
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        photo = FSInputFile(random_image)
        await callback.message.answer_photo(photo, caption="–í–æ—Ç —Ç–µ–±–µ –∫–∞—Ä—Ç–∏–Ω–∫–∞! üñºÔ∏è")
    else:
        await callback.message.answer("–ö–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã üò¢")
    await callback.answer()  # –ó–∞–≤–µ—Ä—à–∞–µ–º callback

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü–æ–≥–æ–¥–∞"
@start_router.callback_query(F.data == "weather")
async def send_weather(callback: types.CallbackQuery):
    await callback.message.answer("–ü–æ–≥–æ–¥–∞ —Å–µ–≥–æ–¥–Ω—è: —Å–æ–ª–Ω–µ—á–Ω–æ! ‚òÄÔ∏è")
    await callback.answer()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ö—É—Ä—Å –≤–∞–ª—é—Ç"
@start_router.callback_query(F.data == "currency")
async def send_currency(callback: types.CallbackQuery):
    await callback.message.answer("–¢–µ–∫—É—â–∏–π –∫—É—Ä—Å –≤–∞–ª—é—Ç: 1 USD = 90 RUB, 1 EUR = 100 RUB")
    await callback.answer()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤"
@start_router.callback_query(F.data == "movies")
async def send_movies(callback: types.CallbackQuery):
    movies = [
        "1. –ö—Ä–µ—Å—Ç–Ω—ã–π –æ—Ç–µ—Ü (1972)",
        "2. –¢–µ–º–Ω—ã–π —Ä—ã—Ü–∞—Ä—å (2008)",
        "3. –ü–æ–±–µ–≥ –∏–∑ –®–æ—É—à–µ–Ω–∫–∞ (1994)",
        "4. –ù–∞—á–∞–ª–æ (2010)",
        "5. –§–æ—Ä—Ä–µ—Å—Ç –ì–∞–º–ø (1994)"
    ]
    await callback.message.answer("–°–ø–∏—Å–æ–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤:\n\n" + "\n".join(movies))
    await callback.answer()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–®—É—Ç–∫–∞"
@start_router.callback_query(F.data == "joke")
async def send_joke(callback: types.CallbackQuery):
    await callback.message.answer("–®—É—Ç–∫–∞: –ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –ø—É—Ç–∞—é—Ç –•—ç–ª–ª–æ—É–∏–Ω –∏ –†–æ–∂–¥–µ—Å—Ç–≤–æ? –ü–æ—Ç–æ–º—É —á—Ç–æ Oct 31 == Dec 25! üòÑ")
    await callback.answer()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–û–ø—Ä–æ—Å"
@start_router.callback_query(F.data == "poll")
async def send_poll(callback: types.CallbackQuery):
    await callback.message.answer_poll(
        question="–ö–∞–∫–æ–π –≤–∞—à –ª—é–±–∏–º—ã–π –∂–∞–Ω—Ä —Ñ–∏–ª—å–º–æ–≤?",
        options=["–ö–æ–º–µ–¥–∏—è", "–î—Ä–∞–º–∞", "–ë–æ–µ–≤–∏–∫", "–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞"],
        is_anonymous=False
    )
    await callback.answer()
